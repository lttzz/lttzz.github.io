<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>二进制炸弹实验 - LTTZZ&#39;s BLOG</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="lttzz" /><meta name="description" content="" /><meta name="keywords" content="Hugo, theme, even, lttzz" />






<meta name="generator" content="Hugo 0.81.0 with theme even" />


<link rel="canonical" href="https://www.lttzz.cn/post/%E4%BA%8C%E8%BF%9B%E5%88%B6%E7%82%B8%E5%BC%B9%E5%AE%9E%E9%AA%8C/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script data-ad-client="ca-pub-6866630216233951" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>




<link href="/sass/main.min.af7fd1da18d66c2b017df5b4cae508ef44cfcac3fb4c7c7a327fe4f4f9e28b08.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="二进制炸弹实验" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.lttzz.cn/post/%E4%BA%8C%E8%BF%9B%E5%88%B6%E7%82%B8%E5%BC%B9%E5%AE%9E%E9%AA%8C/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-02-10T11:20:22&#43;08:00" />
<meta property="article:modified_time" content="2021-02-10T11:20:22&#43;08:00" />

<meta itemprop="name" content="二进制炸弹实验">
<meta itemprop="description" content=""><meta itemprop="datePublished" content="2021-02-10T11:20:22&#43;08:00" />
<meta itemprop="dateModified" content="2021-02-10T11:20:22&#43;08:00" />
<meta itemprop="wordCount" content="2664">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="二进制炸弹实验"/>
<meta name="twitter:description" content=""/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">LTTZZ&#39;s BLOG</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/books/">
        <li class="mobile-menu-item">Books</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">LTTZZ&#39;s BLOG</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/books/">Books</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">二进制炸弹实验</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-02-10 </span>
        
          <span class="more-meta"> 2664 words </span>
          <span class="more-meta"> 6 mins read </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> times read </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#0x00-phase_0">0x00 phase_0</a></li>
    <li><a href="#0x01-phase_1">0x01 phase_1</a></li>
    <li><a href="#0x02-phase_2">0x02 phase_2</a></li>
    <li><a href="#0x03-phase_3">0x03 phase_3</a></li>
    <li><a href="#0x04-phase_4">0x04 phase_4</a></li>
    <li><a href="#0x05-phase_5">0x05 phase_5</a></li>
    <li><a href="#0x06-phase_6">0x06 phase_6</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p><a href="http://cs.nju.edu.cn/sufeng/course/mooc/0809NJU064_bomblab.tar">bomblab.tar</a></p>
<p>执行程序，随意给定输入字符串（偷懒直接拿main.c了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ ./bomb bomb.c
Welcome to my fiendish little bomb. You have <span class="m">7</span> phases with
which to blow yourself up. Have a nice day!

BOOM!!!
The bomb has blown up.

BOOM!!!
The bomb has blown up.

BOOM!!!
The bomb has blown up.

BOOM!!!
The bomb has blown up.

BOOM!!!
The bomb has blown up.

BOOM!!!
The bomb has blown up.

BOOM!!!
The bomb has blown up.
</code></pre></td></tr></table>
</div>
</div><p>查看 <code>main.c</code>，关键函数 <code>phase_i</code> 的细节需要反汇编得出。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cm">/***************************************************************************
</span><span class="cm"> * Dr. Evil&#39;s Insidious Bomb, Version 1.1
</span><span class="cm"> * Copyright 2011, Dr. Evil Incorporated. All rights reserved.
</span><span class="cm"> *
</span><span class="cm"> * LICENSE:
</span><span class="cm"> *
</span><span class="cm"> * Dr. Evil Incorporated (the PERPETRATOR) hereby grants you (the
</span><span class="cm"> * VICTIM) explicit permission to use this bomb (the BOMB).  This is a
</span><span class="cm"> * time limited license, which expires on the death of the VICTIM.
</span><span class="cm"> * The PERPETRATOR takes no responsibility for damage, frustration,
</span><span class="cm"> * insanity, bug-eyes, carpal-tunnel syndrome, loss of sleep, or other
</span><span class="cm"> * harm to the VICTIM.  Unless the PERPETRATOR wants to take credit,
</span><span class="cm"> * that is.  The VICTIM may not distribute this bomb source code to
</span><span class="cm"> * any enemies of the PERPETRATOR.  No VICTIM may debug,
</span><span class="cm"> * reverse-engineer, run &#34;strings&#34; on, decompile, decrypt, or use any
</span><span class="cm"> * other technique to gain knowledge of and defuse the BOMB.  BOMB
</span><span class="cm"> * proof clothing may not be worn when handling this program.  The
</span><span class="cm"> * PERPETRATOR will not apologize for the PERPETRATOR&#39;s poor sense of
</span><span class="cm"> * humor.  This license is null and void where the BOMB is prohibited
</span><span class="cm"> * by law.
</span><span class="cm"> ***************************************************************************/</span>

<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&#34;support.h&#34;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&#34;phases.h&#34;</span><span class="cp">
</span><span class="cp"></span>
<span class="cm">/* 
</span><span class="cm"> * Note to self: Remember to erase this file so my victims will have no
</span><span class="cm"> * idea what is going on, and so they will all blow up in a
</span><span class="cm"> * spectaculary fiendish explosion. -- Dr. Evil 
</span><span class="cm"> */</span>

<span class="n">FILE</span> <span class="o">*</span><span class="n">infile</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">input</span><span class="p">;</span>

    <span class="cm">/* Note to self: remember to port this bomb to Windows and put a 
</span><span class="cm">     * fantastic GUI on it. */</span>

    <span class="cm">/* When run with no arguments, the bomb reads its input lines 
</span><span class="cm">     * from standard input. */</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>  
	<span class="n">infile</span> <span class="o">=</span> <span class="n">stdin</span><span class="p">;</span>
    <span class="p">}</span> 

    <span class="cm">/* When run with one argument &lt;file&gt;, the bomb reads from &lt;file&gt; 
</span><span class="cm">     * until EOF, and then switches to standard input. Thus, as you 
</span><span class="cm">     * defuse each phase, you can add its defusing string to &lt;file&gt; and
</span><span class="cm">     * avoid having to retype it. */</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">infile</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#34;r&#34;</span><span class="p">)))</span> <span class="p">{</span>
	    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s: Error: Couldn&#39;t open %s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	    <span class="n">exit</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
	<span class="p">}</span>
    <span class="p">}</span>

    <span class="cm">/* You can&#39;t call the bomb with more than 1 command line argument. */</span>
    <span class="k">else</span> <span class="p">{</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Usage: %s [&lt;input_file&gt;]</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">exit</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/* Do all sorts of secret stuff that makes the bomb harder to defuse. */</span>
    <span class="n">initialize_bomb</span><span class="p">();</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Welcome to my fiendish little bomb. You have 7 phases with</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;which to blow yourself up. Have a nice day!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>

    <span class="cm">/* Warm up phase! */</span>
    <span class="n">input</span> <span class="o">=</span> <span class="n">read_line</span><span class="p">();</span>             <span class="cm">/* Get input                   */</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">phase_0</span><span class="p">(</span><span class="n">input</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>           <span class="cm">/* Run the phase               */</span>
        <span class="n">phase_defused</span><span class="p">();</span>             <span class="cm">/* Drat!  They figured it out! */</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Well done! You seem to have warmed up!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
	<span class="p">}</span>

    <span class="cm">/* Hmm...  Six phases must be more secure than one phase! */</span>
    <span class="n">input</span> <span class="o">=</span> <span class="n">read_line</span><span class="p">();</span>             <span class="cm">/* Get input                   */</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">phase_1</span><span class="p">(</span><span class="n">input</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>           <span class="cm">/* Run the phase               */</span>
        <span class="n">phase_defused</span><span class="p">();</span>             <span class="cm">/* Drat!  They figured it out! Let me know how they did it. */</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Phase 1 defused. How about the next one?</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
	<span class="p">}</span>

    <span class="cm">/* The second phase is harder.  No one will ever figure out
</span><span class="cm">     * how to defuse this... */</span>
    <span class="n">input</span> <span class="o">=</span> <span class="n">read_line</span><span class="p">();</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">phase_2</span><span class="p">(</span><span class="n">input</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">phase_defused</span><span class="p">();</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;That&#39;s number 2.  Keep going!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
	<span class="p">}</span>

    <span class="cm">/* I guess this is too easy so far.  Some more complex code will
</span><span class="cm">     * confuse people. */</span>
    <span class="n">input</span> <span class="o">=</span> <span class="n">read_line</span><span class="p">();</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">phase_3</span><span class="p">(</span><span class="n">input</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">phase_defused</span><span class="p">();</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Halfway there!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
	<span class="p">}</span>

    <span class="cm">/* Oh yeah?  Well, how good is your math?  Try on this saucy problem! */</span>
    <span class="n">input</span> <span class="o">=</span> <span class="n">read_line</span><span class="p">();</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">phase_4</span><span class="p">(</span><span class="n">input</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">phase_defused</span><span class="p">();</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;So you got that one.  Try this one.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
	<span class="p">}</span>
    
    <span class="cm">/* Round and &#39;round in memory we go, where we stop, the bomb blows! */</span>
    <span class="n">input</span> <span class="o">=</span> <span class="n">read_line</span><span class="p">();</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">phase_5</span><span class="p">(</span><span class="n">input</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">phase_defused</span><span class="p">();</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Good work!  On to the next...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
	<span class="p">}</span>

    <span class="cm">/* This phase will never be used, since no one will get past the
</span><span class="cm">     * earlier ones.  But just in case, make this one extra hard. */</span>
    <span class="n">input</span> <span class="o">=</span> <span class="n">read_line</span><span class="p">();</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">phase_6</span><span class="p">(</span><span class="n">input</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">phase_defused</span><span class="p">();</span>
	<span class="p">}</span>

    <span class="cm">/* Wow, they got it!  But isn&#39;t something... missing?  Perhaps
</span><span class="cm">     * something they overlooked?  Mua ha ha ha ha! */</span>
    
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="0x00-phase_0">0x00 phase_0</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="mi">72</span>	<span class="cm">/* Warm up phase! */</span>
<span class="mi">73</span>	<span class="n">input</span> <span class="o">=</span> <span class="n">read_line</span><span class="p">();</span>             <span class="cm">/* Get input                   */</span>
<span class="mi">74</span>	<span class="nf">if</span><span class="p">(</span> <span class="n">phase_0</span><span class="p">(</span><span class="n">input</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>           <span class="cm">/* Run the phase               */</span>
<span class="mi">75</span>	    <span class="n">phase_defused</span><span class="p">();</span>             <span class="cm">/* Drat!  They figured it out! */</span>
<span class="mi">76</span>	    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Well done! You seem to have warmed up!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
<span class="mi">77</span>	<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>warm up phase，贴心。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">360	08049454 &lt;phase_0&gt;:
361	 8049454:	55                   	push   %ebp  ; 保存旧的ebp
362	 8049455:	89 e5                	mov    %esp,%ebp
363	 8049457:	83 ec 08             	sub    $0x8,%esp
364	 804945a:	83 ec 08             	sub    $0x8,%esp  ; 调整栈帧
365	 804945d:	68 e0 a1 04 08       	push   $0x804a1e0  ; 参数2入栈
366	 8049462:	ff 75 08             	pushl  0x8(%ebp)   ; 参数1入栈
367	 8049465:	e8 f7 07 00 00       	call   8049c61 &lt;strings_not_equal&gt;
368	 804946a:	83 c4 10             	add    $0x10,%esp  ; 调整栈帧
369	 804946d:	85 c0                	test   %eax,%eax   ; 检测eax的值是否为0
370	 804946f:	74 0c                	je     804947d &lt;phase_0+0x29&gt;  ; 是0就跳转到47d处继续执行
371	 8049471:	e8 53 0a 00 00       	call   8049ec9 &lt;explode_bomb&gt;
372	 8049476:	b8 00 00 00 00       	mov    $0x0,%eax
373	 804947b:	eb 05                	jmp    8049482 &lt;phase_0+0x2e&gt;  ; 否则explode_bomb
374	 804947d:	b8 01 00 00 00       	mov    $0x1,%eax  ; 设置函数返回值为
375	 8049482:	c9                   	leave  
376	 8049483:	c3                   	ret 

; phase_0调用了strings_note_equal函数
; 易知ebp+8处存放的是main调用phase_0时传入的参数，也即输入值input

1018  08049c61 &lt;strings_not_equal&gt;:
1019 8049c61:	55                   	push   %ebp
1020 8049c62:	89 e5                	mov    %esp,%ebp  ; 调整栈帧
1021 8049c64:	53                   	push   %ebx  ; 压栈的方式保存被调用者保存寄存器的值
1022 8049c65:	83 ec 10             	sub    $0x10,%esp  ; 调整栈帧
1023 8049c68:	ff 75 08             	pushl  0x8(%ebp)   ; string_not_equal的参数1压栈,也即input
1024 8049c6b:	e8 c5 ff ff ff       	call   8049c35 &lt;string_length&gt;  ; 计算字符串长度
1025 8049c70:	83 c4 04             	add    $0x4,%esp
1026 8049c73:	89 c3                	mov    %eax,%ebx  ; 将参数1的程度保存到ebx
1027 8049c75:	ff 75 0c             	pushl  0xc(%ebp)  ; string_not_equal的参数2压栈
1028 8049c78:	e8 b8 ff ff ff       	call   8049c35 &lt;string_length&gt;
1029 8049c7d:	83 c4 04             	add    $0x4,%esp
1030 8049c80:	39 c3                	cmp    %eax,%ebx  ; 比较参数1和参数2的长度是否相同
1031 8049c82:	74 07                	je     8049c8b &lt;strings_not_equal+0x2a&gt;  ; 长度相同则到c8b处比较各字符是否相同
1032 8049c84:	b8 01 00 00 00       	mov    $0x1,%eax
1033 8049c89:	eb 3c                	jmp    8049cc7 &lt;strings_not_equal+0x66&gt;  ; 长度不同则直接返回1
1034 8049c8b:	8b 45 08             	mov    0x8(%ebp),%eax
1035 8049c8e:	89 45 f8             	mov    %eax,-0x8(%ebp)
1036 8049c91:	8b 45 0c             	mov    0xc(%ebp),%eax
1037 8049c94:	89 45 f4             	mov    %eax,-0xc(%ebp)  ; 将传入的字符串地址赋值给局部变量
1038 8049c97:	eb 1f                	jmp    8049cb8 &lt;strings_not_equal+0x57&gt;
1039 8049c99:	8b 45 f8             	mov    -0x8(%ebp),%eax
1040 8049c9c:	0f b6 10             	movzbl (%eax),%edx
1041 8049c9f:	8b 45 f4             	mov    -0xc(%ebp),%eax
1042 8049ca2:	0f b6 00             	movzbl (%eax),%eax
1043 8049ca5:	38 c2                	cmp    %al,%dl      ; 比较当前位字符
1044 8049ca7:	74 07                	je     8049cb0 &lt;strings_not_equal+0x4f&gt;  ; 相同跳转cb0比较下一位
1045 8049ca9:	b8 01 00 00 00       	mov    $0x1,%eax    ; 不同则中断比较返回1
1046 8049cae:	eb 17                	jmp    8049cc7 &lt;strings_not_equal+0x66&gt;
1047 8049cb0:	83 45 f8 01          	addl   $0x1,-0x8(%ebp)  ; 地址+1
1048 8049cb4:	83 45 f4 01          	addl   $0x1,-0xc(%ebp)  ; 地址+1
1049 8049cb8:	8b 45 f8             	mov    -0x8(%ebp),%eax
1050 8049cbb:	0f b6 00             	movzbl (%eax),%eax
1051 8049cbe:	84 c0                	test   %al,%al    ; 如果遇到EOF则比较结束，因为长度相同，只需要检测其中一个
1052 8049cc0:	75 d7                	jne    8049c99 &lt;strings_not_equal+0x38&gt;  ; 没遇到EOF继续比较
1053 8049cc2:	b8 00 00 00 00       	mov    $0x0,%eax
1054 8049cc7:	8b 5d fc             	mov    -0x4(%ebp),%ebx
1055 8049cca:	c9                   	leave  
1056 8049ccb:	c3                   	ret 
</code></pre></td></tr></table>
</div>
</div><p><code>phase_0</code> 将输入值和设定值传入<code>strings_not_equal</code>比较，相同返回1，不相同调用<code>explode_bomb</code>，具体的比较过程交给<code>strings_not_equal</code>处理。</p>
<p>用gdb动态调试找出设定好的字符串，<code>phase_0</code> 处下断，使用<code>run input.txt</code> 运行程序的同时给定命令行参数指定读入的文件。</p>
<p><img src="/Picbed/2021_02/0210_00.png" alt="phase_0"></p>
<h1 id="0x01-phase_1">0x01 phase_1</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="mi">67</span>  <span class="cm">/* Hmm...  Six phases must be more secure than one phase! */</span>
<span class="mi">68</span>  <span class="n">input</span> <span class="o">=</span> <span class="n">read_line</span><span class="p">();</span>             <span class="cm">/* Get input                   */</span>
<span class="mi">69</span>  <span class="nf">if</span><span class="p">(</span> <span class="n">phase_1</span><span class="p">(</span><span class="n">input</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>           <span class="cm">/* Run the phase               */</span>
<span class="mi">70</span>      <span class="n">phase_defused</span><span class="p">();</span>             <span class="cm">/* Drat!  They figured it out! Let me know how they did it. */</span>
<span class="mi">71</span>      <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Phase 1 defused. How about the next one?</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
<span class="mi">72</span>      <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>查看反汇编代码，似乎仅仅是读入两个数，然后与设定的局部双精度浮点变量进行比较，比较的方式奇怪了些，不是一个双精度浮点数和一个整数在真值上比较，而是一个浮点数和两个整数在机器数上比较。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">377  08049484 &lt;phase_1&gt;:                                                   
378   8049484:       55                      push   %ebp                
379   8049485:       89 e5                   mov    %esp,%ebp         
380   8049487:       83 ec 28                sub    $0x28,%esp  ; 调整栈帧              
381   804948a:       c7 45 f4 a1 84 76 09    movl   $0x97684a1,-0xc(%ebp)  
382   8049491:       db 45 f4                fildl  -0xc(%ebp)  ; int-&gt;double后压栈
383   8049494:       dd 5d e8                fstpl  -0x18(%ebp) ; double-&gt;double后出栈
384   8049497:       8d 45 e0                lea    -0x20(%ebp),%eax
385   804949a:       50                      push   %eax        ; sscanf的参数4入栈
386   804949b:       8d 45 e4                lea    -0x1c(%ebp),%eax   
387   804949e:       50                      push   %eax        ; sscanf的参数3入栈           
388   804949f:       68 0f a2 04 08          push   $0x804a20f  ; sscanf的参数2入栈
389   80494a4:       ff 75 08                pushl  0x8(%ebp)   ; sscanf的参数1入栈
390   80494a7:       e8 24 fc ff ff          call   80490d0 &lt;__isoc99_sscanf@plt&gt;  ; 调用sscanf
391   80494ac:       83 c4 10                add    $0x10,%esp	; 调整栈帧
392   80494af:       83 f8 02                cmp    $0x2,%eax   ; 测试sscanf是否成功读取2次
393   80494b2:       74 0c                   je     80494c0 &lt;phase_1+0x3c&gt; ; 是就跳到4c0处继续执行
394   80494b4:       e8 10 0a 00 00          call   8049ec9 &lt;explode_bomb&gt; ; 否则调用explode_bomb
395   80494b9:       b8 00 00 00 00          mov    $0x0,%eax
396   80494be:       eb 2c                   jmp    80494ec &lt;phase_1+0x68&gt; ; 返回0
397   80494c0:       8d 45 e8                lea    -0x18(%ebp),%eax
398   80494c3:       8b 10                   mov    (%eax),%edx
399   80494c5:       8b 45 e4                mov    -0x1c(%ebp),%eax
400   80494c8:       39 c2                   cmp    %eax,%edx    ; 比较ebp+0x18和ebp+0x1c处的值
401   80494ca:       75 0f                   jne    80494db &lt;phase_1+0x57&gt;
402   80494cc:       8d 45 e8                lea    -0x18(%ebp),%eax
403   80494cf:       83 c0 04                add    $0x4,%eax
404   80494d2:       8b 10                   mov    (%eax),%edx
405   80494d4:       8b 45 e0                mov    -0x20(%ebp),%eax
406   80494d7:       39 c2                   cmp    %eax,%edx    ; 比较ebp+0x14和ebp+0x20处的值
407   80494d9:       74 0c                   je     80494e7 &lt;phase_1+0x63&gt;
408   80494db:       e8 e9 09 00 00          call   8049ec9 &lt;explode_bomb&gt;
409   80494e0:       b8 00 00 00 00          mov    $0x0,%eax
410   80494e5:       eb 05                   jmp    80494ec &lt;phase_1+0x68&gt;
411   80494e7:       b8 01 00 00 00          mov    $0x1,%eax
412   80494ec:       c9                      leave   
413   80494ed:       c3                      ret
</code></pre></td></tr></table>
</div>
</div><p><img src="/Picbed/2021_02/0210_01.png" alt="phase_1"></p>
<h1 id="0x02-phase_2">0x02 phase_2</h1>
<h1 id="0x03-phase_3">0x03 phase_3</h1>
<h1 id="0x04-phase_4">0x04 phase_4</h1>
<h1 id="0x05-phase_5">0x05 phase_5</h1>
<h1 id="0x06-phase_6">0x06 phase_6</h1>
    </div>

    
<footer class="post-footer">
      
      <nav class="post-nav">
        <a class="prev" href="/post/%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">常用软件</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/mooc%E7%AC%94%E8%AE%B0/">
            <span class="next-text nav-default">MOOC笔记</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=Snl5fn5-e318cn0KOztkKSUn" class="iconfont icon-email" title="email"></a>
      <a href="https://stackoverflow.com/users/9786406/lttzz" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="https://github.com/lttzz" class="iconfont icon-github" title="github"></a>
      <a href="https://weibo.com/lttzz" class="iconfont icon-weibo" title="weibo"></a>
      <a href="https://www.douban.com/people/196540309/" class="iconfont icon-douban" title="douban"></a>
      <a href="https://space.bilibili.com/74153503" class="iconfont icon-bilibili" title="bilibili"></a>
  <a href="https://www.lttzz.cn/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> site pv: <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> site uv: <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2020 - 
    2021<span class="heart"><i class="iconfont icon-heart"></i></span><span>lttzz</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-140228231-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







</body>
</html>
